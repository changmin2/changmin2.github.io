---
title:  "SOLID 원칙 적용"

categories:
  - 스프링
tags:
  - Blog
toc: true
toc_sticky: true
---

## 좋은 객체 지향 설계의 5가지 원칙(SOLID) 위반과 적용

### DIP, OCP 위반 사례

다음과 같은 할인 정책을 위한 인터페이스가 있다고 가정하자.

```java
public interface DiscountPolicy{
    int discount(Member member,int price);
}
```

1. 무조건 천원을 할인 해주는 정책

```java
public class FixDiscountPolicy implements DiscountPolicy {
    private int discountFixAmount = 1000; //1000원 할인
    @Override
    public int discount(Member member, int price) {
        if (member.getGrade() == Grade.VIP) {
            return discountFixAmount;
        } else {
             return 0;
            }
        }
}
```

2. VIP 고객에게는 구매 금액의 10%를 할인해주는 정책 코드

```java
public class RateDicountPolicy implements DiscountPolicy {
    private int discountPercent= 10; //10% 할인
    @Override
    public int discount(Member member, int price) {
        if (member.getGrade() == Grade.VIP) {
            return price*dicountPercent/100;
        } else {
             return 0;
            }
        }
}
```

만약 처음에는 FixDiscountPolicy() 할인 정책을 사용하다가 10%할인 정책인 RateDiscountPolicy()를 사용하게되면 다음과 같은 코드가 필요하다.

```java
    public class OrderSerivceImpl(){
    // 변경전
    //private final DiscountPolicy discountPolicy = new FixDiscountPolicy()
    //변경후
    private final DiscountPolicy discountPolicy = new RateDiscountPolicy()
    }
```
- 역할과 구현을 분리했다(O)
- 다형성도 활용하고, 인터페이스와 구현 객체를 분리했다(O)
- OCP,DIP 같은 객체지향 설계 원칙을 준수했다(X)
-> 추상(인터페이스) 뿐만 아니라 구체(구현) 클래스에도 의존하고 코드도 직접 변경하므로 지키지 못하였다.

![GitHub Logo](/image/interface.png)
그림과 같이 정책을 변경하는 순간 소스코드도 함께 변경(OCP위반)

아래와 같이 인터페이스에만 의존하도록 변경하는 것이 목표
![GitHub Logo](/image/onlyinteface.png)

### OCP, DIP 위반 해결

#### AppConfig 등장

애플리케이션의 전체 동작 방식을 구성(config)하기 위해, 구현 객체를 생성하고, 연결하는 책임을 가지는 별도의 설정클래스

```java
public class AppConfig {

    private DiscountPolicy dicountPolicy() {
        return new RateDicountPolicy();
    }
}
```
-> 정책이 바뀔 때마다 AppConfig에서 수정

AppConfig 이용
정책을 직접 주입하지 않고 생성자로 주입할 수 있게 변환

```java
    public class OrderSerivceImpl(){
        private final DiscountPolicy discountPolicy;

        public OrderServiceImpl(DiscountPolicy discountPolicy) {
            this.discountPolicy = discountPolicy;
        }
    }
```
사용예시

```java
    AppConfig appConfig = new AppConfig();
    DiscountPolicy policy = appConfig.discountPolicy();
```
- 이제 OrderServiceImpl은 어떤 정책이 연결될지 모르고 연결은 AppConfig가 생성자를 통해서 주입(연결)해준다.
- 클라이언트인 OrderServiceImpl 입장에서 보면 의존관계를 마치 외부에서 주입해주는 것 같다고 해서 DI(Dependency Injection) 우리말로 의존관계 주입 또는 의존성 주입이라 한다.
- 클라이언트 코드를 직접 변경하지 않아도됨(**OCP해결**), OrderServiceImpl은 이제 추상에만 의존(**DIP해결**)

출처 : 인프런 김영한의 스프링 핵심원리 기본편